<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <%= stylesheet_link_tag 'styles' %>
</head>
<body>
<h1>Item Tally</h1>


<% for user in @users %>
	<h2><%= user.login.titleize %></h2>
	
	<table>
	  <tr>
	    <th>Title</th>
	    <th>Date</th>
	    <th>Amount</th>
	    <th>Note</th>
	  </tr>

	<% for item in @items.find_all { |i| i.user.login == user.login } %>
	  <tr>
		<td><%=h item.date %></td>    
		<td><%=h item.title %></td>
	    <td><%=h number_to_currency(item.amount) %></td>
	    <td><%=h item.note %></td>
	    <td><%= link_to 'Show', item %></td>
		
		<%# In this context, @user is the current user %>
		<% if @user == user then %>
		    <td><%= link_to 'Edit', edit_item_path(item) %></td>
		    <td><%= link_to 'Kill', item, :confirm => 'Are you sure?', :method => :delete %></td>
		<% end %>
	  </tr>
	<% end %>
	</table>
	
<% end %>


<br />

<%= link_to 'New item', new_item_path %>
</body>
</html>
